/* 弹窗基础样式 */
.modal {
    position: absolute;
    /* 相对于 stage-wrapper 定位 */
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    /* modal 容器纯透明，不阻挡点击(除了内容) */
    background: transparent;
    z-index: 200;
    /* 高于 Lantern(150) 和 Mask(110) */
    display: flex;
    justify-content: center;
    align-items: center;
    opacity: 1;
    transition: opacity 0.3s ease;
    border-radius: inherit;
    /* 跟随 wrapper 的圆角 */
    pointer-events: none;
    /* 让点击穿透透明区域 */
    font-family: 'FZZhunYuan-M02', "Founder Rounded", "Hiragino Sans GB", "Microsoft YaHei", sans-serif;
}

.modal.hidden {
    opacity: 0;
    pointer-events: none;
    display: none;
    /* 防止遮挡 */
}

/* 独立遮罩层 */
#card-mask {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.6);
    /* Chrome 59 不支持 backdrop-filter，添加回退方案：更深的背景色 */
    background-color: rgba(0, 0, 0, 0.85);
    backdrop-filter: blur(2px);
    /* 如果支持则生效 */
    z-index: 110;
    /* 高于 Floater(10), 低于 Lantern(150) */
    opacity: 1;
    transition: opacity 0.5s;
    pointer-events: auto;
    /* 阻挡点击 */
    border-radius: inherit;
}

#card-mask.hidden {
    opacity: 0;
    pointer-events: none;
}

@supports (backdrop-filter: blur(2px)) or (-webkit-backdrop-filter: blur(2px)) {
    .modal-overlay {
        background-color: rgba(0, 0, 0, 0.6);
        -webkit-backdrop-filter: blur(2px);
        backdrop-filter: blur(2px);
    }
}

.modal-content {
    position: relative;
    width: 98%;
    /* 撑满舞台 */
    height: 92%;
    /* 调整高度比例，适配附图 */
    background: transparent;
    z-index: 101;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    /* 垂直居中卡片 */
    /* 垂直居中卡片 */
    transform-origin: center center;
    pointer-events: auto;
    /* 关键：恢复内容的点击交互 */
}

/* 卡片主体 (Postcard Refactor) */
.card-body {
    display: flex;
    width: 85%;
    max-width: 9.5rem;
    height: 76%;
    max-height: 6.5rem;
    /* 明信片纸张底色 */
    background: #f9f9f9;
    background-image: radial-gradient(#e0e0e0 1px, transparent 1px);
    background-size: 0.2rem 0.2rem;
    border-radius: 0;
    /* 去掉圆角 */
    overflow: hidden;
    box-shadow: 0 0.3rem 0.8rem rgba(0, 0, 0, 0.4);
    transform: scale(0.1);
    opacity: 0;
    /* 移除自动播放，改为 .active 类触发 */
    /* animation: popIn 0.5s ... forwards; */
    /* 增加卡片白边框 & 内描边 & 投影 */
    border: 0.12rem solid #fff;
    outline: 1px solid #ccc;
    /* 外轮廓 */
    box-shadow: 0 0.3rem 0.8rem rgba(0, 0, 0, 0.5), inset 0 0 0 1px #e0e0e0;
    /* 内部描边 */
}

/* 激活状态才播放动画 */
.card-body.active {
    animation: popIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
}

@keyframes popIn {
    from {
        transform: scale(0.1);
        opacity: 0;
    }

    to {
        transform: scale(1);
        opacity: 1;
    }
}

/* 左侧：动态贺图区 */
.card-left {
    flex: 0 0 auto;
    /* 由内容(3:4图片)撑开宽度 */
    /* background: #000; */
    background: #fff;
    /* 改为白色背景，融合边框 */
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    border-right: 1px dashed #e0e0e0;
    /* 弱化分割线 */
}

.frame-player-container {
    /* 强制 3:4 比例控制 */
    /* 由于高度跟随父容器，我们主要控制宽度或使用 padding hack? 
       但在 Flex 布局且高度固定的情况下，最好让 img/canvas 撑开宽度，或者限制容器尺寸。
       Chrome 59 不支持 aspect-ratio。
    */
    height: 100%;
    width: auto;
    aspect-ratio: 3/4;
    /* 尝试加上，现代浏览器生效 */
    /* 移除 max-width限制，依靠高度决定宽度 */

    /* Chrome 59 Fallback: 基于高度计算宽度较难纯CSS，
       但我们可以让内部 canvas object-fit: contain，并让容器背景色合适。
       或者，既然父容器flexrow，我们让 height 100%，width由内容决定?
    */
    flex: 0 0 auto;
    /* 不伸缩，由内容决定 */

    border: none;
    border-radius: 0;
    box-shadow: none;
    background: #fff;
    overflow: hidden;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
    margin-right: -1px;
    /* 消除缝隙 */
}

#frame-canvas {
    height: 100%;
    width: auto;
    /* 保持图片原有比例 (3:4) */
    object-fit: contain;
}

/* 右侧：明信片文本区 */
.card-right {
    flex: 1;
    position: relative;
    display: flex;
    flex-direction: column;
    padding: 0.3rem 0.3rem 0.2rem 0.3rem;
    /* 增加内边距 */
    color: #333;
    font-family: "FangSong", "STFangsong", "SimSun", serif;
    justify-content: space-between;
    /* 垂直分布 */
}

/* --- 邮戳区域（右上角） --- */
/* --- 邮戳区域（调整为顶部通栏） --- */
.postcard-stamp-area {
    position: absolute;
    top: 0.2rem;
    left: 0.2rem;
    /* 左对齐 */
    right: 0.2rem;
    /* 右对齐 */
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    /* 左右分布：左邮编，右邮票 */
    z-index: 5;
    pointer-events: none;
    /* 防止遮挡下方点击 */
}

/* 邮政编码格子 */
.postal-code {
    display: flex;
    gap: 0.05rem;
}

.postal-cell {
    width: 0.28rem;
    /* 缩小 */
    height: 0.28rem;
    border: 2px solid #333;
    background: #fff;
}

/* 邮票区域 */
.stamp-box {
    width: 1.1rem;
    /* 缩小 */
    height: 1.1rem;
    border: none;
    background: transparent;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    box-shadow: none;
    transform: rotate(6deg);
    margin-top: -0.1rem;
}

.stamp-placeholder {
    font-size: 0.14rem;
    color: #ddd;
    font-family: sans-serif;
    font-weight: bold;
    transform: rotate(-30deg);
}

.stamp-box img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    filter: drop-shadow(2px 2px 3px rgba(0, 0, 0, 0.2));
}

/* --- 移除旧的顶部 Tabs --- */
.card-tabs {
    display: none;
}

/* --- 迷你 Tab 样式（弱化视觉） --- */
.mini-tabs {
    display: flex;
    justify-content: center;
    align-items: center;
    margin-top: 0.3rem;
    /* 增加与标题的距离 */
    gap: 0.1rem;
}

.mini-tab {
    font-size: 0.14rem;
    /* 放大字号 */
    color: #999;
    cursor: pointer;
    padding: 0.04rem 0.1rem;
    transition: all 0.2s;
    font-family: -apple-system, sans-serif;
    border-radius: 0.04rem;
}

.mini-tab:hover {
    color: #666;
}

.mini-tab.active {
    color: #e0443e;
    background: rgba(224, 68, 62, 0.08);
}

.mini-tab-divider {
    color: #ddd;
    font-size: 0.1rem;
    user-select: none;
}

/* --- Tab 内容容器 --- */
.card-tab-content {
    flex: 1;
    position: relative;
    overflow: hidden;
    display: flex;
    /* Ensure container behaves as flex context */
    flex-direction: column;
}

.tab-pane {
    display: none;
    height: 100%;
    flex-direction: column;
    animation: fadeInPane 0.3s;
    width: 100%;
}

.tab-pane.active {
    display: flex;
    flex: 1;
}

@keyframes fadeInPane {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* --- 寓意卡片样式 (暖色风格) --- */
.meaning-card {
    background: linear-gradient(135deg, #fff8f0 0%, #fff3e8 100%);
    border: 1px solid rgba(255, 152, 0, 0.2);
    border-radius: 0.08rem;
    padding: 0.15rem;
    height: 100%;
    display: flex;
    flex-direction: column;
    position: relative;
}

.meaning-card-content {
    flex: 1;
    font-size: 0.16rem;
    line-height: 1.8;
    color: #5d4037;
    font-family: 'FZZhunYuan-M02', "方正准圆", "Microsoft YaHei", sans-serif;
    overflow-y: auto;
    padding-bottom: 0.35rem;
    /* 给按钮留空间 */
}

.meaning-label {
    color: #e65100;
    font-weight: 600;
}

.meaning-text {
    color: #5d4037;
}

/* --- 内部切换按钮 (右下角定位) --- */
.card-toggle-btn {
    position: absolute;
    bottom: 0.12rem;
    right: 0.12rem;
}

.btn-toggle {
    font-size: 0.13rem;
    padding: 0.06rem 0.14rem;
    border-radius: 0.04rem;
    border: 1px solid rgba(255, 152, 0, 0.3);
    background: rgba(255, 152, 0, 0.1);
    color: #e65100;
    cursor: pointer;
    transition: all 0.2s;
    font-family: -apple-system, sans-serif;
}

.btn-toggle:hover {
    background: rgba(255, 152, 0, 0.2);
}

/* 提示词区域的返回按钮（浅色风格） */
.btn-toggle-light {
    border: 1px solid rgba(0, 255, 255, 0.4);
    background: rgba(0, 255, 255, 0.1);
    color: #00f0ff;
}

.btn-toggle-light:hover {
    background: rgba(0, 255, 255, 0.2);
}

.terminal-toggle {
    bottom: 0.12rem;
    right: 0.12rem;
}

/* 明信片头部 (To & Title) */
.postcard-header {
    margin-bottom: 0.05rem;
    margin-top: 0.6rem;
    /* 减小上边距 */
    padding-left: 0.1rem;
}

.field-to {
    font-size: 0.24rem;
    /* 缩小 */
    color: #333;
    margin-bottom: 0.05rem;
    font-weight: bold;
    text-transform: uppercase;
}

#card-recipient {
    font-weight: bold;
    color: #000;
    border-bottom: 2px solid #000;
    padding: 0 0.1rem;
    margin-left: 0.1rem;
    font-size: 0.28rem;
    /* 缩小 */
}

/* 标题区 */
.blessing-title-box {
    text-align: center;
    margin: 0.2rem 0 0.3rem 0;
    position: relative;
}

.field-pinyin {
    display: none;
    /* 隐藏拼音 */
    font-size: 0.14rem;
    color: #e0443e;
    letter-spacing: 0.08rem;
    text-transform: uppercase;
    font-family: -apple-system, sans-serif;
    opacity: 0.8;
    margin-bottom: 0rem;
}

.field-title {
    font-size: 0.42rem;
    font-weight: 500;
    /* 改为更细的字重，提高可读性 */
    color: #e64a19;
    letter-spacing: 0.05rem;
    margin-top: 0rem;
    /* 移除描边，保留柔和阴影 */
    text-shadow: 1px 1px 0px #fff, 0 0 3px rgba(255, 87, 34, 0.1);
}

/* 明信片正文容器 */
.postcard-body {
    flex: 1;
    overflow-y: auto;
    margin-bottom: 0.1rem;
}

/* 打字机容器 */
.typewriter-container {
    font-size: 0.16rem;
    /* 缩小 */
    line-height: 1.8;
    color: #333;
    white-space: pre-wrap;
    /* 保留换行 */
    min-height: 0.8rem;
    /* 减小最小高度 */
}

/* Prompt Info Grid - 优化为灰色底座样式 */
.prompt-info-grid {
    display: grid;
    grid-template-columns: 1fr;
    grid-gap: 0.08rem;
    /* Chrome 59 supports grid-gap */
    background: #ededed;
    /* 更深的灰 */
    padding: 0.15rem;
    border-radius: 0.08rem;
    margin-bottom: 0.2rem;
    font-family: -apple-system, sans-serif;
    border-left: 4px solid #ccc;
    /* 装饰线 */
}

.info-row {
    font-size: 0.13rem;
    display: flex;
    align-items: baseline;
}

.info-row .label {
    color: #888;
    width: 0.6rem;
}

.info-row .value {
    color: #333;
    font-weight: 500;
}

/* 底部按钮区 */
.postcard-footer {
    height: auto;
    padding: 0.2rem 0;
    display: flex;
    align-items: center;
    justify-content: center;
}

/* 按钮样式复用 btn-primary 但微调 */
#accept-btn {
    padding: 0.12rem 0.5rem;
    /* 缩小 padding */
    font-size: 0.18rem;
    /* 缩小字号 */
    /* 暖橙色渐变 */
    background: linear-gradient(135deg, #ff9800 0%, #ff5722 100%);
    box-shadow: 0 0.1rem 0.2rem rgba(255, 87, 34, 0.3);
    color: white;
    border: none;
    border-radius: 0.4rem;
    cursor: pointer;
    font-weight: bold;
    letter-spacing: 0.02rem;
    transition: transform 0.2s, box-shadow 0.2s;
}

#accept-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 0.15rem 0.25rem rgba(255, 87, 34, 0.4);
}

#accept-btn:active {
    transform: translateY(0);
}

/* 悬浮进度条样式 - REM 化 */
.slider-control.floating-slider {
    position: absolute;
    bottom: 0.1rem;
    left: 50%;
    transform: translateX(-50%);
    width: 90%;
    background: rgba(0, 0, 0, 0.5);
    padding: 0.05rem 0.1rem;
    border-radius: 0.15rem;
    z-index: 5;
    opacity: 0;
    transition: opacity 0.3s;
}

.frame-player-container:hover .slider-control.floating-slider {
    opacity: 1;
}

input[type=range] {
    width: 100%;
    cursor: pointer;
    background: transparent;
    height: 0.06rem;
    -webkit-appearance: none;
    appearance: none;
    margin: 0;
    padding: 0;
    display: block;
}

input[type=range]::-webkit-slider-runnable-track {
    width: 100%;
    height: 0.06rem;
    background: rgba(255, 255, 255, 0.5);
    border-radius: 0.03rem;
}

input[type=range]::-webkit-slider-thumb {
    -webkit-appearance: none;
    height: 0.16rem;
    width: 0.16rem;
    border-radius: 50%;
    background: #ff9800;
    border: 2px solid #fff;
    margin-top: -0.05rem;
    box-shadow: 0 0 0.05rem rgba(0, 0, 0, 0.3);
}

/* --- 动画类 --- */
@keyframes blink {
    50% {
        opacity: 0;
    }
}

.cursor {
    display: inline-block;
    width: 2px;
    height: 1em;
    background-color: #333;
    margin-left: 2px;
    vertical-align: text-bottom;
    animation: blink 0.8s infinite;
}

.hidden-initially {
    opacity: 0;
    visibility: hidden;
}

.fade-in-up {
    animation: fadeInUp 0.6s forwards;
}

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(0.2rem);
    }

    to {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
    }
}

/* 响应式适配 - 保持左右布局，不改为上下 */
@media screen and (max-width: 800px) {
    .card-body {
        /* 保持 flex-direction: row，不改为 column */
        flex-direction: row;
        overflow: hidden;
    }

    .card-left {
        flex: 0 0 40%;
        /* 缩小左侧比例 */
        border-right: 1px dashed #ccc;
    }

    .card-right {
        flex: 1;
        padding: 0.12rem;
        padding-top: 0.1rem;
        overflow-y: auto;
    }

    /* 小屏下邮戳区域缩小 */
    .postcard-stamp-area {
        top: 0.08rem;
        right: 0.08rem;
    }

    .postal-cell {
        width: 0.12rem;
        height: 0.16rem;
    }

    .stamp-box {
        width: 0.4rem;
        height: 0.5rem;
    }

    /* 小屏下字号略微缩小 */
    .field-title {
        font-size: 0.32rem;
    }

    .typewriter-container {
        font-size: 0.16rem;
    }

    .frame-player-container {
        border-radius: 0;
    }
}

/* ===========================================
   手风琴布局样式 (Accordion Layout)
   =========================================== */

.card-accordion {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 0.15rem;
    overflow-y: auto;
    padding-right: 0.05rem;
}

.accordion-section {
    border-radius: 0.08rem;
    overflow: hidden;
}

.accordion-header {
    display: flex;
    align-items: center;
    gap: 0.08rem;
    padding: 0.1rem 0.12rem;
    font-size: 0.14rem;
    font-weight: 600;
    cursor: default;
}

.section-icon {
    font-size: 0.12rem;
}

.section-title {
    flex: 1;
}

/* 寓意区域 - 暖色风格 */
.meaning-section {
    background: linear-gradient(135deg, #fff8f0 0%, #fff3e8 100%);
    border: 1px solid rgba(255, 152, 0, 0.2);
}

.meaning-header {
    color: #e65100;
    border-bottom: 1px solid rgba(255, 152, 0, 0.15);
}

.meaning-body {
    padding: 0.12rem 0.15rem;
    font-size: 0.14rem;
    line-height: 1.7;
    color: #5d4037;
    max-height: 1.2rem;
    overflow-y: auto;
    font-family: 'FZZhunYuan-M02', "方正准圆", "Microsoft YaHei", sans-serif;
}

/* 提示词区域 - 科技终端风格 */
.prompt-section {
    background: rgba(0, 20, 40, 0.9);
    border: 1px solid rgba(0, 255, 255, 0.3);
    box-shadow: 0 0 10px rgba(0, 255, 255, 0.1);
}

.prompt-header {
    color: rgba(0, 255, 255, 0.9);
    cursor: pointer;
    transition: background 0.2s;
}

.prompt-header:hover {
    background: rgba(0, 255, 255, 0.1);
}

.toggle-arrow {
    font-size: 0.1rem;
    transition: transform 0.3s ease;
    display: inline-block;
}

.prompt-section:not(.collapsed) .toggle-arrow {
    transform: rotate(90deg);
}

.prompt-body {
    max-height: 2rem;
    overflow: hidden;
    transition: max-height 0.3s ease, padding 0.3s ease;
    padding: 0 0.12rem 0.12rem 0.12rem;
}

.prompt-section.collapsed .prompt-body {
    max-height: 0;
    padding-top: 0;
    padding-bottom: 0;
}

/* 科技终端卡片 */
.prompt-terminal {
    background: rgba(0, 20, 40, 0.95);
    border: 1px solid rgba(0, 255, 255, 0.3);
    border-radius: 0.08rem;
    box-shadow: 0 0 15px rgba(0, 255, 255, 0.15);
    padding: 0.15rem;
    padding-bottom: 0.4rem;
    /* 给按钮留空间 */
    font-family: 'Courier New', 'Monaco', monospace;
    font-size: 0.14rem;
    line-height: 1.6;
    color: rgba(255, 255, 255, 0.85);
    height: 100%;
    overflow-y: auto;
    position: relative;
}

.terminal-row {
    display: flex;
    gap: 0.08rem;
    margin-bottom: 0.06rem;
}

.terminal-label {
    color: rgba(255, 255, 255, 0.5);
    flex-shrink: 0;
}

.terminal-value {
    color: #00f0ff;
    text-shadow: 0 0 8px rgba(0, 240, 255, 0.5);
    font-weight: bold;
}

/* Prompt 文本样式：接在 label 后面 */
.terminal-prompt-text {
    flex: 1;
    font-weight: normal;
    word-break: break-word;
}

.terminal-divider {
    height: 1px;
    background: linear-gradient(90deg, rgba(0, 255, 255, 0.4) 0%, transparent 100%);
    margin: 0.08rem 0;
}

.terminal-content {
    color: rgba(200, 255, 200, 0.9);
    white-space: pre-wrap;
    word-break: break-word;
    max-height: 1rem;
    overflow-y: auto;
}

/* 终端区域滚动条 */
.terminal-content::-webkit-scrollbar {
    width: 4px;
}

.terminal-content::-webkit-scrollbar-track {
    background: rgba(0, 0, 0, 0.3);
}

.terminal-content::-webkit-scrollbar-thumb {
    background: rgba(0, 255, 255, 0.3);
    border-radius: 2px;
}

/* 寓意区域滚动条 */
.meaning-body::-webkit-scrollbar {
    width: 4px;
}

.meaning-body::-webkit-scrollbar-track {
    background: rgba(255, 152, 0, 0.1);
}

.meaning-body::-webkit-scrollbar-thumb {
    background: rgba(255, 152, 0, 0.3);
    border-radius: 2px;
}