!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.XpathExec=t():e.XpathExec=t()}(self,function(){return function(){"use strict";function e(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var t={textContent:"",isVisible:!1,isReadOnly:!1,position:{top:0,left:0},size:{width:0,height:0},name:{id:"",className:"",tagName:""},innerWidth:0,innerHeight:0,clientWidth:0,clientHeight:0,screenWidth:0,screenHeight:0,fullHtml:"",xpath:"",type:"Regular"},i=new(function(){var i;function n(){if(!(this instanceof n))throw TypeError("Cannot call a class as a function");e(this,"dom",void 0),e(this,"readOnlyRows",void 0),e(this,"info",void 0),this.dom=null,this.readOnlyRows={},this.info=t,this.init()}return i=[{key:"addEvent",value:function(){var e=this;window.addEventListener("message",function(t){if("EXEC_XPATH"===t.data.type){var i,n=e.getDomInfo(t.data.xpath);null==(i=window.parent)||i.postMessage({type:"EXEC_XPATH_RESULT",result:n},"*")}})}},{key:"init",value:function(){this.setWindowInfo(),this.addEvent()}},{key:"setWindowInfo",value:function(){this.info.innerHeight=window.innerHeight,this.info.innerWidth=window.innerWidth,this.info.clientWidth=document.documentElement.clientWidth,this.info.clientHeight=document.documentElement.clientHeight,this.info.screenWidth=window.screen.width,this.info.screenHeight=window.screen.height}},{key:"getComputedStyle",value:function(){if(this.dom){var e=this.dom.getBoundingClientRect(),t=e.width,i=e.height,n=e.left,o=e.top,s=this.info,a=s.innerWidth,d=s.innerHeight;this.info.position.left=+(n/a).toFixed(5),this.info.position.top=+(o/d).toFixed(5),this.info.size.width=+(t/a).toFixed(5),this.info.size.height=+(i/d).toFixed(5),this.info.textContent=this.dom.textContent||"",this.info.isVisible="none"!==window.getComputedStyle(this.dom).display}}},{key:"getName",value:function(){if(this.dom){var e=this.dom,t=e.id,i=e.className,n=e.tagName;this.info.name.id=t,this.info.name.className=i,this.info.name.tagName=n}}},{key:"getFullHtml",value:function(){var e=new XMLSerializer().serializeToString(document);this.info.fullHtml=e}},{key:"setIsReadOnly",value:function(){if(this.dom){if(!window.editor){this.info.isReadOnly=!1;return}if(this.info.name.className.includes("ace-readonly__group")){this.info.isReadOnly=!0;return}var e,t=this.dom.parentNode;if(null==t||null==(e=t.className)?void 0:e.includes("ace_text-layer")){var i=Array.from(t.children).indexOf(this.dom);this.info.isReadOnly=this.readOnlyRows[i]||!1}}}},{key:"getDomInfoFromH5",value:function(e){var t=document.querySelector("iframe");t&&t.contentWindow&&(t.contentWindow.postMessage({type:"EXEC_XPATH",xpath:e,width:this.info.innerWidth,height:this.info.innerHeight},"*"),new Promise(function(e){var t=function(i){"EXEC_XPATH_RESULT"===i.data.type&&(e(i.data.result),window.removeEventListener("message",t))};window.addEventListener("message",t)}).then(function(e){console.log("h5dom信息",e),window.SetIframeDomInfo&&window.SetIframeDomInfo(encodeURIComponent(e))}))}},{key:"getDomInfo",value:function(e){var t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.setWindowInfo();var n=decodeURIComponent(escape(window.atob(e)));if(this.info.xpath=n,this.info.type=1===i?"Webview":"Regular",1===i)return this.getDomInfoFromH5(e),"";var o=document.evaluate(n,document,null,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null).iterateNext();return o&&(null==o?void 0:o.nodeType)===1?(this.dom=o,this.setIsReadOnly(),this.getComputedStyle(),this.getName(),this.getFullHtml(),t=JSON.stringify(this.info),window.btoa(unescape(encodeURIComponent(t)))):""}}],function(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(n.prototype,i),n}()),n=i.getDomInfo.bind(i);return window.GetDomInfo=n,{}}()});